{% extends 'techstore/storeadmin-page.html' %}
{% block content %}
<div class="container">
  
  <ul class="nav nav-tabs ">
    <li class="nav-item">
      <a class="nav-link active" data-bs-toggle="tab" href="#received">Products Received</a>
    </li>
    <li class="nav-item ">
      <a class="nav-link " data-bs-toggle="tab" href="#add">Add Product</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-bs-toggle="tab" href="#create">Create Product Category</a>
    </li>
  </ul>
  <div class="tab-content mt-3">
    <div class="tab-pane fade show active" id="received">
      <h3>Products received</h3>
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
      <table class="table table-bordered ">
        <thead class="table-info">
          <tr>
            <th>ID</th>
            <th>Category</th>
            <th>Model</th>
            <th>Quantity</th>
            <th>Purchased Date</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for product in products %}
            <tr>
              <td>{{ product.id }}</td>
              <td>{{ product.category.name }}</td>
              <td>{{ product.model }}</td>
              <td>{{ product.quantity }}</td>
              <td>{{ product.purchased_date }}</td>
              <td>
                <a href="{% url 'edit_product' product.id %}#add" class="btn btn-sm btn-warning">Edit</a>
                <a href="{% url 'delete_product' product.id %}" class="btn btn-sm btn-danger"
                   onclick="return confirm('Are you sure you want to delete this product?');">Delete</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      
    </div>
    

    <div class="tab-pane fade" id="add">
      <h3>Add Product</h3>
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
      
      <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="product_id" value="{{ edit_product.id|default:'' }}">
        
        <div class="row mb-3">
          <div class="col">
            <label for="category">Product Category</label>
            <select name="category" id="category" class="form-select" required>
              <option value="" disabled {% if not edit_product %}selected{% endif %}>Select Category</option>
              {% for cat in categories %}
                <option value="{{ cat.id }}" {% if edit_product and cat.id == edit_product.category.id %}selected{% endif %}>{{ cat.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col">
            <label for="model">Product Model</label>
            <input type="text" name="model" class="form-control" required value="{{ edit_product.model|default:'' }}">
          </div>
        </div>
      
        <div class="row mb-3">
          <div class="col">
            <label for="quantity">Quantity</label>
            <input type="number" name="quantity" class="form-control" required value="{{ edit_product.quantity|default:'' }}">
          </div>
          <div class="col">
            <label for="purchased_date">Purchased Date</label>
            <input type="date" name="purchased_date" class="form-control" required value="{{ edit_product.purchased_date|date:'Y-m-d' }}">
          </div>
        </div>
      
        <div class="mb-3">
          <label for="reference_details">Reference Details</label>
          <input type="text" name="reference_details" class="form-control" required value="{{ edit_product.reference_details|default:'' }}">
        </div>
      
        <div class="mb-3">
          <label for="description">Description</label>
          <textarea name="description" class="form-control">{{ edit_product.description|default:'' }}</textarea>
        </div>
      
        <div class="mb-3">
          <label for="warranty_expiry_date">Warranty Expiry Date</label>
          <input type="date" name="warranty_expiry_date" class="form-control" value="{{ edit_product.warranty_expiry_date|date:'Y-m-d' }}">
        </div>
      
        <div class="mb-3">
          <label for="vendor_details">Vendor Details</label>
          <textarea name="vendor_details" class="form-control">{{ edit_product.vendor_details|default:'' }}</textarea>
        </div>
      
        <div class="mb-3">
          <label for="delivery_challan">Upload Delivery Challan / RC</label>
          <input type="file" name="delivery_challan" class="form-control">
        </div>
      
        <button type="submit" name="form_type" value="add_product" class="btn btn-primary">
          {% if edit_product %}Update Product{% else %}Add Product{% endif %}
        </button>
      </form>
      
    </div>

    
    <div class="tab-pane fade" id="create">
      <h3>Create Product Category</h3>
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    
      <form method="post">
        {% csrf_token %}
        <div class="mb-3">
          <label for="categoryName" class="form-label">Product Category Name</label>
          <input type="text" class="form-control" id="categoryName" name="category_name" placeholder="Enter category name" required>
        </div>
        <button type="submit" name="form_type" value="create_category" class="btn btn-primary">Create Category</button>
      </form>

      <hr>

  <h5 class="mt-4">Existing Categories</h5>
  <table class="table table-bordered mt-2 ">
    <thead class="table-info">
      <tr>
        <th scope="col">#</th>
        <th scope="col">Category Name</th>
      </tr>
    </thead>
    <tbody>
      {% for category in categories %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ category.name }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="2">No categories added yet.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
    </div>
    
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const hash = window.location.hash;
    if (hash) {
      const triggerEl = document.querySelector(`a[href="${hash}"]`);
      if (triggerEl) {
        new bootstrap.Tab(triggerEl).show();
      }
    }
  });
</script>
{% endblock %}
