{% extends 'techstore/storeuser-page.html' %}
{% block usercontent %}
<div class="container mt-4">
  <ul class="nav nav-tabs" id="ordersTab" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="stock-tab" data-bs-toggle="tab" href="#stock" role="tab">Stock Summary</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="create-tab" data-bs-toggle="tab" href="#create" role="tab">Create Supply Order</a>
    </li>
  </ul>
  
  <div class="tab-content mt-3">
    <div class="tab-pane fade show active" id="stock">
      <h3>Products Supplied</h3>
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    </div>
    <div class="tab-pane fade" id="create" role="tabpanel">
      <h3>Create Supply Order</h3>
      <form method="post" action="{% url 'create_user_supply_order' %}">
        {% csrf_token %}
        <div class="mb-3">
          <label for="category">Category</label>
          <select name="category" id="userCategorySelect" class="form-control" required>
            <option value="">Select Category</option>
            {% for category in categories %}
              <option value="{{ category.id }}">{{ category.name }}</option>
            {% endfor %}
          </select>
        </div>
    
        <div class="mb-3">
          <label for="model">Model</label>
          <select name="model" id="userModelSelect" class="form-control" required>
            <option value="">Select Model</option>
          </select>
        </div>
      
        <div class="mb-3">
          <label for="quantity_supplied">Quantity Supplied</label>
          <select name="quantity_supplied" id="userQuantitySelect" class="form-control" required>
            <option value="">Select Quantity</option>
          </select>
        </div>
      
        <div class="mb-3">
          <label for="supplied_date">Supplied Date</label>
          <input type="date" name="supplied_date" class="form-control" required>
        </div>
      
        <div class="mb-3">
          <label for="description">Description</label>
          <textarea name="description" class="form-control" rows="2" required></textarea>
        </div>
      
        <div class="mb-3">
          <label for="received_person_name">Received Person Name</label>
          <input type="text" name="received_person_name" class="form-control" required>
        </div>
      
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>
  </div>

  {% comment %} script to update models based on category selection {% endcomment %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
        const categorySelect = document.getElementById('userCategorySelect');
        const modelSelect = document.getElementById('userModelSelect');
    
        categorySelect.addEventListener('change', function () {
            const categoryId = this.value;
            modelSelect.innerHTML = '<option value="">Loading...</option>';
    
            fetch(`/store-user/get-models/?category_id=${categoryId}`)
                .then(response => response.json())
                .then(data => {
                    modelSelect.innerHTML = '<option value="">Select Model</option>';
                    data.models.forEach(model => {
                        modelSelect.innerHTML += `<option value="${model.id}">${model.model}</option>`;
                    });
                })
                .catch(error => {
                    modelSelect.innerHTML = '<option value="">Error loading models</option>';
                    console.error('Error:', error);
                });
        });
    });
  </script>

  {% comment %} script to update quantity based on model selection  {% endcomment %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
        const categorySelect = document.getElementById('userCategorySelect');
        const modelSelect = document.getElementById('userModelSelect');
        const quantitySelect = document.getElementById('userQuantitySelect');
    
        categorySelect.addEventListener('change', function () {
            const categoryId = this.value;
            modelSelect.innerHTML = '<option value="">Loading...</option>';
            quantitySelect.innerHTML = '<option value="">Select Quantity</option>';
    
            fetch(`/store-user/get-models/?category_id=${categoryId}`)
                .then(response => response.json())
                .then(data => {
                    modelSelect.innerHTML = '<option value="">Select Model</option>';
                    data.models.forEach(model => {
                        modelSelect.innerHTML += `<option value="${model.id}">${model.model}</option>`;
                    });
                });
        });
    
        modelSelect.addEventListener('change', function () {
            const modelId = this.value;
            quantitySelect.innerHTML = '<option value="">Loading...</option>';
    
            fetch(`/store-user/get-available-quantity/?model_id=${modelId}`)
                .then(response => response.json())
                .then(data => {
                    quantitySelect.innerHTML = '<option value="">Select Quantity</option>';
                    for (let i = 1; i <= data.available_quantity; i++) {
                        quantitySelect.innerHTML += `<option value="${i}">${i}</option>`;
                    }
                    if (data.available_quantity === 0) {
                        quantitySelect.innerHTML = '<option value="">No quantity available</option>';
                    }
                });
        });
    });
  </script>
        
      
</div>


{% endblock %}